<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>üéüÔ∏è Super Rifa</title>

<style>
body{font-family:Arial,sans-serif;background:#f2f2f2;margin:0;padding:15px}
h1,h2{text-align:center}

.hero,.card{
  background:#fff;
  padding:16px;
  border-radius:12px;
  margin-bottom:16px;
  box-shadow:0 4px 10px rgba(0,0,0,.08)
}
.hero img{width:100%;border-radius:12px;margin-bottom:10px}

button{
  width:100%;
  padding:14px;
  margin-top:10px;
  border:none;
  border-radius:10px;
  background:#4CAF50;
  color:white;
  font-size:17px;
  cursor:pointer
}
button.secondary{background:#2196F3}

input{width:100%;padding:10px;margin-top:6px;font-size:15px}

.packages{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(140px,1fr));
  gap:10px
}

/* üî• MODAL */
.modal{
  display:none;
  position:fixed;
  top:0;left:0;
  width:100%;height:100%;
  background:rgba(0,0,0,.6);
  align-items:center;
  justify-content:center;
  z-index:999;
}
.modal-box{
  background:#fff;
  width:90%;
  max-width:360px;
  padding:25px;
  border-radius:14px;
  text-align:center;
}
.modal-box h2{margin-bottom:15px}
</style>
</head>

<body>

<div class="hero">
  <img id="slide" src="img/Foto1.jpg">
  <h1>üéüÔ∏è GRAN RIFA OFICIAL</h1>
  <p>Muy pronto todo esto ser√° tuyo</p>
</div>

<div class="card">
  <h2>üì¶ Paquetes</h2>
  <div class="packages">
    <button onclick="elegir(10)">10 n√∫meros<br>$50.000</button>
    <button onclick="elegir(20)">20 n√∫meros<br>$100.000</button>
    <button onclick="elegir(50)">50 n√∫meros<br>$250.000</button>
    <button onclick="elegir(100)">100 n√∫meros<br>$500.000</button>
    <button onclick="elegir(150)">150 n√∫meros<br>$750.000</button>
  </div>
</div>

<div class="card">
  <h2>‚úèÔ∏è Personalizado</h2>
  <input type="number" id="cantidad" min="10" placeholder="M√≠nimo 10 n√∫meros">
  <button onclick="personalizado()">Continuar</button>
</div>

<!-- üî• MODAL OPCIONES -->
<div class="modal" id="modal">
  <div class="modal-box">
    <h2>üéØ ¬øC√≥mo quieres tus n√∫meros?</h2>
    <button class="secondary" onclick="azar()">üé≤ Al azar</button>
    <button onclick="seleccionar()">‚úã Seleccionar</button>
  </div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-app.js";
import { getFirestore, collection, query, where, getDocs } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyBMKX5fQXRZP-Ic0_Z6yWqD0LBWSn6H2t4",
  authDomain: "rifa-2026-1a341.firebaseapp.com",
  projectId: "rifa-2026-1a341"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

window.db=db;
window.collection=collection;
window.query=query;
window.where=where;
window.getDocs=getDocs;
</script>

<script>
let cantidad=0;
const PRECIO=5000;
const TOTAL=10000;

function elegir(c){
  cantidad=c;
  abrirModal();
}

function personalizado(){
  const c = Number(document.getElementById("cantidad").value);
  if(c<10){ alert("M√≠nimo 10 n√∫meros"); return; }
  cantidad=c;
  abrirModal();
}

function abrirModal(){
  document.getElementById("modal").style.display="flex";
}

function cerrarModal(){
  document.getElementById("modal").style.display="none";
}

async function azar(){
  cerrarModal();

  const bloqueados=new Set();
  const q=query(collection(db,"compras"),where("estado","in",["pendiente","confirmado"]));
  const snap=await getDocs(q);

  snap.forEach(d=>{
    const c=d.data();
    if(Array.isArray(c.numeros)) c.numeros.forEach(n=>bloqueados.add(n));
  });

  const libres=[];
  for(let i=0;i<TOTAL;i++){
    const n=i.toString().padStart(4,"0");
    if(!bloqueados.has(n)) libres.push(n);
  }

  if(libres.length<cantidad){
    alert("No hay suficientes n√∫meros");
    return;
  }

  const sel=[];
  while(sel.length<cantidad){
    const r=libres[Math.floor(Math.random()*libres.length)];
    if(!sel.includes(r)) sel.push(r);
  }

  localStorage.setItem("numeros",JSON.stringify(sel));
  localStorage.setItem("cantidad",cantidad);
  localStorage.setItem("total",cantidad*PRECIO);
  location.href="checkout.html";
}

function seleccionar(){
  cerrarModal();
  localStorage.setItem("cantidad",cantidad);
  location.href="seleccionar.html";
}
</script>

</body>
</html>
